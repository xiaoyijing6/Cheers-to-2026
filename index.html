<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <!-- å…¨ç«¯é€‚é…æ ¸å¿ƒé…ç½® -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no">
  <title>2026è·¨å¹´å€’è®¡æ—¶ï¼ˆ00:00å®šç‚¹æ’­æ”¾ï¼‰</title>
  <style>
    /* å…¨å±€é‡ç½® + å“åº”å¼åŸºç¡€ï¼ˆä¿ç•™åŸæœ‰ï¼‰ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    body {
      font-family: 'PingFang SC', 'Noto Sans TC', sans-serif;
      background: #000; /* ä¿ç•™åŸæœ‰èƒŒæ™¯ */
      height: 100vh;
      overflow: hidden;
      color: #fff;
    }

    /* çƒŸèŠ±å®¹å™¨ï¼ˆä¿ç•™åŸæœ‰ï¼‰ */
    .fireworks-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 9999;
    }
    
    /* å€’è®¡æ—¶å®¹å™¨ï¼ˆä¿ç•™åŸæœ‰å“åº”å¼ï¼‰ */
    #countdown {
      color: #fff;
      font-weight: 900;
      text-align: center;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 9999;
      width: 95%;
    }
    .countdown-time {
      font-size: clamp(24px, 8vw, 72px);
      text-shadow: 0 0 10px #ff3366, 0 0 20px #ff3366;
      margin-bottom: 12px;
    }
    .countdown-tip {
      font-size: clamp(14px, 4vw, 24px);
      color: #ffccdd;
      opacity: 0.9;
    }

    /* æ–°å¹´ç¥ç¦å®¹å™¨ï¼ˆä¿ç•™åŸæœ‰ï¼‰ */
    .new-year-message-wrapper {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 9999;
      text-align: center;
      width: 95%;
    }
    .new-year-message {
      font-family: 'PingFang SC', 'Noto Sans TC', sans-serif;
      font-weight: 900;
      font-size: clamp(30px, 10vw, 72px);
      color: #fff;
      text-shadow: 0 0 15px #ff6699;
      opacity: 0;
      transition: opacity 0.5s ease, transform 0.5s ease;
      transform: translateY(20px);
      margin-bottom: 16px;
    }
    .new-year-message.show {
      opacity: 1;
      transform: translateY(0);
    }
    .new-year-sub-message {
      font-size: clamp(16px, 5vw, 28px);
      color: #ffddaa;
      opacity: 0;
      transition: opacity 0.8s ease 0.3s;
      text-shadow: 0 0 10px #ff9966;
    }
    .new-year-sub-message.show {
      opacity: 1;
    }

    /* æ ¸å¿ƒä¿®æ”¹ï¼šæŒ‰é’®å…¨ç«¯å›ºå®šä¸‹æ–¹ä¸­é—´ï¼Œæ–‡å­—ä¸ºhappy */
    .test-button {
      position: fixed !important; /* å¼ºåˆ¶å›ºå®šå®šä½ï¼Œé¿å…åç§» */
      bottom: max(20px, env(safe-area-inset-bottom) + 10px) !important; /* é€‚é…è‹¹æœåº•éƒ¨å®‰å…¨åŒº */
      left: 50% !important;
      top: auto !important; /* æ¸…ç©ºåŸæœ‰topå€¼ï¼Œé¿å…å†²çª */
      transform: translateX(-50%) !important; /* ä»…æ°´å¹³å±…ä¸­ï¼Œæ— å‚ç›´åç§» */
      width: clamp(100px, 25vw, 120px);
      height: clamp(100px, 25vw, 120px);
      background-color: rgba(255, 51, 102, 0.2);
      color: #fff;
      border: none;
      font-size: clamp(14px, 4vw, 24px);
      cursor: pointer;
      border-radius: 50%;
      z-index: 10000;
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px); /* è‹¹æœå…¼å®¹ */
    }
    .test-button:hover {
      background-color: rgba(255, 51, 102, 0.4);
    }
    .test-button:active {
      transform: translateX(-50%) scale(0.95) !important; /* ç‚¹å‡»åé¦ˆé€‚é…å±…ä¸­ */
    }

    /* è¤ç«è™«/æ¨±èŠ±å®¹å™¨ï¼ˆä¿ç•™åŸæœ‰ï¼‰ */
    #fireflyContainer {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
    }
    .firefly {
      position: absolute;
      pointer-events: none;
      transition: opacity 1s ease-in-out, transform 2s ease-in-out, left 5s linear, top 5s linear;
    }

    /* éšè—æ— ç”¨å…ƒç´ ï¼ˆä¿ç•™åŸæœ‰ï¼‰ */
    .snow-container, #rainCanvas {
      display: none !important;
    }
  </style>
  <link rel="stylesheet" href="css/StarrySky.css">
  <link rel="stylesheet" href="css/snow.css">
  <script src="https://cdn.jsdelivr.net/npm/fireworks-js@2.x/dist/index.umd.js"></script>
  <script src="js/StarrySky.js"></script>
  <script src="js/switch.js"></script>
  <script src="js/snow.js"></script>
  <script src="js/sakura.js"></script>
  <!-- Shaderä»£ç å®Œå…¨ä¿ç•™ -->
  <script id="sakura_point_vsh" type="x-shader/x_vertex">
uniform mat4 uProjection;
uniform mat4 uModelview;
uniform vec3 uResolution;
uniform vec3 uOffset;
uniform vec3 uDOF;  //x:focus distance, y:focus radius, z:max radius
uniform vec3 uFade; //x:start distance, y:half distance, z:near fade start

attribute vec3 aPosition;
attribute vec3 aEuler;
attribute vec2 aMisc; //x:size, y:fade

varying vec3 pposition;
varying float psize;
varying float palpha;
varying float pdist;

varying vec3 normX;
varying vec3 normY;
varying vec3 normZ;
varying vec3 normal;

varying float diffuse;
varying float specular;
varying float rstop;
varying float distancefade;

void main(void) {
    vec4 pos = uModelview * vec4(aPosition + uOffset, 1.0);
    gl_Position = uProjection * pos;
    gl_PointSize = aMisc.x * uProjection[1][1] / -pos.z * uResolution.y * 0.5;
    
    pposition = pos.xyz;
    psize = aMisc.x;
    pdist = length(pos.xyz);
    palpha = smoothstep(0.0, 1.0, (pdist - 0.1) / uFade.z);
    
    vec3 elrsn = sin(aEuler);
    vec3 elrcs = cos(aEuler);
    mat3 rotx = mat3(
        1.0, 0.0, 0.0,
        0.0, elrcs.x, elrsn.x,
        0.0, -elrsn.x, elrcs.x
    );
    mat3 roty = mat3(
        elrcs.y, 0.0, -elrsn.y,
        0.0, 1.0, 0.0,
        elrsn.y, 0.0, elrcs.y
    );
    mat3 rotz = mat3(
        elrcs.z, elrsn.z, 0.0, 
        -elrsn.z, elrcs.z, 0.0,
        0.0, 0.0, 1.0
    );
    mat3 rotmat = rotx * roty * rotz;
    normal = rotmat[2];
    
    mat3 trrotm = mat3(
        rotmat[0][0], rotmat[1][0], rotmat[2][0],
        rotmat[0][1], rotmat[1][1], rotmat[2][1],
        rotmat[0][2], rotmat[1][2], rotmat[2][2]
    );
    normX = trrotm[0];
    normY = trrotm[1];
    normZ = trrotm[2];
    
    const vec3 lit = vec3(0.6917144638660746, 0.6917144638660746, -0.20751433915982237);
    
    float tmpdfs = dot(lit, normal);
    if(tmpdfs < 0.0) {
        normal = -normal;
        tmpdfs = dot(lit, normal);
    }
    diffuse = 0.4 + tmpdfs;
    
    vec3 eyev = normalize(-pos.xyz);
    if(dot(eyev, normal) > 0.0) {
        vec3 hv = normalize(eyev + lit);
        specular = pow(max(dot(hv, normal), 0.0), 20.0);
    }
    else {
        specular = 0.0;
    }
    
    rstop = clamp((abs(pdist - uDOF.x) - uDOF.y) / uDOF.z, 0.0, 1.0);
    rstop = pow(rstop, 0.5);
    distancefade = min(1.0, exp((uFade.x - pdist) * 0.69315 / uFade.y));
}
  </script>
  <script id="sakura_point_fsh" type="x-shader/x_fragment">
#ifdef GL_ES
precision highp float;
#endif

uniform vec3 uDOF;  //x:focus distance, y:focus radius, z:max radius
uniform vec3 uFade; //x:start distance, y:half distance, z:near fade start

const vec3 fadeCol = vec3(0.08, 0.03, 0.06);

varying vec3 pposition;
varying float psize;
varying float palpha;
varying float pdist;

varying vec3 normX;
varying vec3 normY;
varying vec3 normZ;
varying vec3 normal;

varying float diffuse;
varying float specular;
varying float rstop;
varying float distancefade;

float ellipse(vec2 p, vec2 o, vec2 r) {
    vec2 lp = (p - o) / r;
    return length(lp) - 1.0;
}

void main(void) {
    vec3 p = vec3(gl_PointCoord - vec2(0.5, 0.5), 0.0) * 2.0;
    vec3 d = vec3(0.0, 0.0, -1.0);
    float nd = normZ.z;
    if(abs(nd) < 0.0001) discard;
    
    float np = dot(normZ, p);
    vec3 tp = p + d * np / nd;
    vec2 coord = vec2(dot(normX, tp), dot(normY, tp));
    
    const float flwrsn = 0.258819045102521;
    const float flwrcs = 0.965925826289068;
    mat2 flwrm = mat2(flwrcs, -flwrsn, flwrsn, flwrcs);
    vec2 flwrp = vec2(abs(coord.x), coord.y) * flwrm;
    
    float r;
    if(flwrp.x < 0.0) {
        r = ellipse(flwrp, vec2(0.065, 0.024) * 0.5, vec2(0.36, 0.96) * 0.5);
    }
    else {
        r = ellipse(flwrp, vec2(0.065, 0.024) * 0.5, vec2(0.58, 0.96) * 0.5);
    }
    
    if(r > rstop) discard;
    
    vec3 col = mix(vec3(1.0, 0.8, 0.75), vec3(1.0, 0.9, 0.87), r);
    float grady = mix(0.0, 1.0, pow(coord.y * 0.5 + 0.5, 0.35));
    col *= vec3(1.0, grady, grady);
    col *= mix(0.8, 1.0, pow(abs(coord.x), 0.3));
    col = col * diffuse + specular;
    
    col = mix(fadeCol, col, distancefade);
    
    float alpha = (rstop > 0.001)? (0.5 - r / (rstop * 2.0)) : 1.0;
    alpha = smoothstep(0.0, 1.0, alpha) * palpha;
    
    gl_FragColor = vec4(col * 0.5, alpha);
}
  </script>
  <script id="fx_common_vsh" type="x-shader/x_vertex">
uniform vec3 uResolution;
attribute vec2 aPosition;

varying vec2 texCoord;
varying vec2 screenCoord;

void main(void) {
    gl_Position = vec4(aPosition, 0.0, 1.0);
    texCoord = aPosition.xy * 0.5 + vec2(0.5, 0.5);
    screenCoord = aPosition.xy * vec2(uResolution.z, 1.0);
}
  </script>
  <script id="bg_fsh" type="x-shader/x_fragment">
#ifdef GL_ES
precision highp float;
#endif

uniform vec2 uTimes;

varying vec2 texCoord;
varying vec2 screenCoord;

void main(void) {
    discard;
}
  </script>
  <script id="fx_brightbuf_fsh" type="x-shader/x_fragment">
#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D uSrc;
uniform vec2 uDelta;

varying vec2 texCoord;
varying vec2 screenCoord;

void main(void) {
    discard;
}
  </script>
  <script id="fx_dirblur_r4_fsh" type="x-shader/x_fragment">
#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D uSrc;
uniform vec2 uDelta;
uniform vec4 uBlurDir;

varying vec2 texCoord;
varying vec2 screenCoord;

void main(void) {
    discard;
}
  </script>
  <script id="fx_common_fsh" type="x-shader/x_fragment">
#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D uSrc;
uniform vec2 uDelta;

varying vec2 texCoord;
varying vec2 screenCoord;

void main(void) {
    gl_FragColor = texture2D(uSrc, texCoord);
}
  </script>
  <script id="pp_final_vsh" type="x-shader/x_vertex">
uniform vec3 uResolution;
attribute vec2 aPosition;
varying vec2 texCoord;
varying vec2 screenCoord;
void main(void) {
    gl_Position = vec4(aPosition, 0.0, 1.0);
    texCoord = aPosition.xy * 0.5 + vec2(0.5, 0.5);
    screenCoord = aPosition.xy * vec2(uResolution.z, 1.0);
}
  </script>
  <script id="pp_final_fsh" type="x-shader/x_fragment">
#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D uSrc;
uniform sampler2D uBloom;
uniform vec2 uDelta;
varying vec2 texCoord;
varying vec2 screenCoord;
void main(void) {
    vec4 srccol = texture2D(uSrc, texCoord) * 2.0;
    vec4 bloomcol = texture2D(uBloom, texCoord);
    vec4 col;
    col = srccol + bloomcol * (vec4(1.0) + srccol);
    col *= smoothstep(1.0, 0.0, pow(length((texCoord - vec2(0.5)) * 2.0), 1.2) * 0.5);
    col = pow(col, vec4(0.45454545454545));
    
    gl_FragColor = vec4(col.rgb, 1.0);
    gl_FragColor.a = 0.0;
}
  </script>
</head>
<body>
<audio id="audio" src="" preload="auto"></audio>

<div id="twitch-player" style="display: none; position: fixed; bottom: 20px; left: 20px; z-index: 101;">
  <iframe src="https://player.twitch.tv/?channel=terrorcat7414&enableExtensions=true&muted=true&parent=ranke96.github.io&player=popout&quality=chunked&volume=1" frameborder="0" width="480" height="270" style="background-color: transparent;"></iframe>
</div>
    
<div id="chat-widget" style="display: none; position: fixed; bottom: 20px; right: 20px; z-index: 100;">
  <iframe id="obs-chat-iframe" src="https://nightdev.com/hosted/obschat?theme=undefined&channel=terrorcat7414&fade=15&bot_activity=false&prevent_clipping=false" frameborder="0" width="300" height="400" style="background-color: transparent;"></iframe>
</div>

<div id="countdown">
  <div class="countdown-time" id="countdown-time">00:00:00</div>
  <div class="countdown-tip">è·ç¦»00:00 è¿˜æœ‰</div>
</div>

<div class="fireworks-container"></div>  
    
<div class="noite"><canvas id="rainCanvas"></canvas><canvas id="sakura"></canvas></div>
<div id="fireflyContainer"></div>
<div class="constelacao"></div>
<div class="lua">
  <div class="textura"></div>
  <!-- æŒ‰é’®æ–‡å­—æ”¹ä¸ºhappyï¼Œä½ç½®é€šè¿‡CSSå›ºå®šä¸‹æ–¹ä¸­é—´ -->
  <button class="test-button" onclick="startCountdown(); playAudio();">happy</button>
</div>
<div class="snow-container" style="display: none;"></div>
    
<div class="chuvaMeteoro"></div>
<div class="floresta">
  <img src="image/city.png" alt="" />
</div>

<script src="js/rain.js"></script>
<script src="js/fire.js"></script>
<script>
  // å¤šæ¡æ–°å¹´ç¥ç¦è¯­æ•°ç»„
  const newYearMessages = [
    { main: "2026æ–°å¹´å¿«ä¹ ğŸ†", sub: "æ„¿æ–°å¹´ï¼Œèƒœæ—§å¹´ï¼Œå²å²å®‰æ¾œ" },
    { main: "æ–°æ˜¥å¿«ä¹ ğŸŒŸ", sub: "æ‰€æ±‚çš†å¦‚æ„¿ï¼Œæ‰€è¡Œçš†å¦é€”" },
    { main: "è·¨å¹´å¿«ä¹ ğŸ‡", sub: "çƒŸç«å‘æ˜Ÿè¾°ï¼Œæ‰€æ„¿çš†æˆçœŸ" },
    { main: "2026ä¸‡äº‹å…´é¾™ ğŸ‰", sub: "æ—¥å­æ»šçƒ«ï¼Œæˆ‘ä»¬æ¥æ—¥æ–¹é•¿" },
    { main: "æ–°å¹´å¤§å‰ ğŸ§§", sub: "å¹³å®‰å–œä¹ï¼Œè¯¸äº‹é¡ºé‚" },
    { main: "å–œè¿2026 ğŸŠ", sub: "æ–°å²å¯å°ï¼Œå¥”èµ´æ–°ç¨‹" },
    { main: "å²å²å¸¸æ¬¢æ„‰ ğŸ¥³", sub: "å¹´å¹´çš†èƒœæ„ï¼Œå¹´å¹´æœ‰ä»Šæœ" }
  ];

  // ç²¾å‡†å€’è®¡æ—¶é€»è¾‘
  function getTargetMidnight() {
    const now = new Date();
    const target = new Date(now);
    target.setHours(23, 59, 59, 999);
    if (now > target) {
      target.setDate(target.getDate() + 1);
      target.setHours(0, 0, 0, 0);
    }
    return target.getTime();
  }

  let targetTime = getTargetMidnight();
  let countdownInterval = null;
  const formatTime = (num) => num.toString().padStart(2, '0');

  const updateCountdown = () => {
    const now = new Date().getTime();
    const distance = targetTime - now;

    if (distance < 10) {
      clearInterval(countdownInterval);
      document.getElementById('countdown').style.display = 'none';
      displayHappyNewYearMessage();
      startFireworks();
      targetTime = getTargetMidnight();
      return;
    }

    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((distance % (1000 * 60)) / 1000);
    const countdownText = `${formatTime(hours)}:${formatTime(minutes)}:${formatTime(seconds)}`;
    document.getElementById('countdown-time').innerText = countdownText;

    if (distance <= 10000) {
      document.querySelector('.countdown-time').style.fontSize = `clamp(30px, 12vw, 80px)`;
      document.querySelector('.countdown-time').style.color = '#ffdd00';
    }
  };

  // å¤šç¥ç¦è¯­å¿«é€Ÿæ¶ˆå¤±å±•ç¤º
  function displayHappyNewYearMessage() {
    const wrapper = document.createElement('div');
    wrapper.className = 'new-year-message-wrapper';
    document.body.appendChild(wrapper);

    const randomMsg = newYearMessages[Math.floor(Math.random() * newYearMessages.length)];
    const mainMsg = document.createElement('div');
    mainMsg.className = 'new-year-message';
    mainMsg.innerText = randomMsg.main;
    wrapper.appendChild(mainMsg);

    const subMsg = document.createElement('div');
    subMsg.className = 'new-year-sub-message';
    subMsg.innerText = randomMsg.sub;
    wrapper.appendChild(subMsg);

    setTimeout(() => {
      mainMsg.classList.add('show');
      subMsg.classList.add('show');
    }, 10);

    // å¿«é€Ÿæ¶ˆå¤±ï¼š1ç§’åæ·¡å‡ºï¼Œ2ç§’åç§»é™¤
    setTimeout(() => {
      mainMsg.style.opacity = 0;
      subMsg.style.opacity = 0;
    }, 1000); 
    setTimeout(() => {
      wrapper.remove();
    }, 2000);
  }

  // çƒŸèŠ±æ•ˆæœ
  function startFireworks() {
    const container = document.querySelector('.fireworks-container');
    const fireworksConfig = {
      autoresize: true,
      opacity: 0.5,
      acceleration: 1.05,
      friction: 0.97,
      gravity: 1.5,
      particles: 50,
      traceLength: 3,
      traceSpeed: 10,
      explosion: 5,
      intensity: 100,
      flickering: 50,
      lineStyle: 'round',
      hue: { min: 0, max: 360 },
      delay: { min: 30, max: 60 },
      rocketsPoint: { min: 50, max: 50 },
      lineWidth: {
        explosion: { min: 1, max: 3 },
        trace: { min: 1, max: 2 }
      },
      brightness: { min: 55, max: 100 },
      decay: { min: 0.015, max: 0.03 },
      mouse: { click: true, move: false, max: 10 },
      sound: {
        enabled: true,
        files: ["https://fireworks.js.org/sounds/explosion0.mp3", "https://fireworks.js.org/sounds/explosion1.mp3",  "https://fireworks.js.org/sounds/explosion2.mp3"],
        volume: { min: 4, max: 8 }
      }
    };

    const fireworks = new Fireworks.default(container, fireworksConfig);
    fireworks.start();
  }

  function startCountdown() {
    displayHappyNewYearMessage();
    startFireworks();
    clearInterval(countdownInterval);
    document.getElementById('countdown').style.display = 'none';
  }

  let chatVisible = false;
    
  // æ ¸å¿ƒä¿®æ”¹ï¼šç§»é™¤alertæç¤ºæ¡†ï¼Œä»…ä¿ç•™æ§åˆ¶å°æ—¥å¿—
  function playAudio() {
    const audio = document.getElementById('audio');
    audio.play().catch(err => {
      // åˆ é™¤alertè¯­å¥ï¼Œä»…ä¿ç•™æ—¥å¿—ä¾¿äºè°ƒè¯•
      console.log('éŸ³é¢‘æ’­æ”¾å¤±è´¥ï¼š', err);
    });
  }

  window.addEventListener('resize', () => {
    updateCountdown();
  });

  // åˆå§‹åŒ–å€’è®¡æ—¶
  countdownInterval = setInterval(updateCountdown, 1000);
  updateCountdown();
</script>

</body>
</html>